# LerdgeX Klipper
 Заметки по установке и настроке Klipper на плате LerdgeX

# Компиляция прошивки

Последнии версии Klipper не собираются по иструкции от Lerdge, чтобы прошивка собралась надо вручную кое-что изменить.

Что изменить в файле ~/klipper/src/stm32/Kconfig

найти:
```
bool "64KiB bootloader" if MACH_STM32F103 || MACH_STM32F446 || MACH_STM32F401
```
изменить на:
```
bool "64KiB bootloader" if MACH_STM32F103 || MACH_STM32F446 || MACH_STM32F401 || MACH_STM32F407
```

найти:
```
default 0x20000 if MACH_STM32F4x5 || MACH_STM32F446
```
изменить на:
```
default 0x1FFF0 if MACH_STM32F4x5 || MACH_STM32F446
```

Дальше в принципе все по официальной инструкции, только теперь просто выбираем "64KiB bootloader"

# Подключение к одноплатному компьютеру

Для подключения к RaspberryPi или OrangePi удобно использовать разьем к которому подключается плата WiFi, т.е. без использования USB.

На изображении указаны пины UART, для подключения одноплатного ПК, т.е. RX подключаем к пину RX одноплатника, соотвественно TX подключаем к пину TX.

Активация режима UART на разных одноплатниках и дистрибутивах может быть различна, посмотрите документацию по одноплатнику  и дистрибутиву.

![](/images/Ext_rxtx.png)

# Распиновка разьема расширения

Ниже дана распиновка разьема расширения, эти пины можно использовать для подключения дополнительной перефирии.
Пины PA9 и PA10 использовать не получится, т.к. они используются для обменна данных по UART.

![](/images/LerdgeX_extension.png)

# Подключение драйверов TMC2209 для работы по UART

TMC2209 умеют работать в режиме подключения по одному проводу, при этом каждому драйверу задается адрес, максимальное число драйверов на одной линии 4.

Для начала установим адреса перемычками MS1 и MS2, перемычки MS3 должны быть отключены! 
__ADR__ - это какой адрес получит драйвер.

||MS1|MS2|ADR|
|---|---|---|---|
|X|OFF|OFF|0|
|Y|ON|OFF|1|
|Z|OFF|ON|2|
|E|ON|ON|3|

Далее соединяем все пины RX на драйверах и подключаем к выводу __PC2__ на разьеме расширения (возможно использовать любой другой пин).

![](/images/uart_schematic.png)

Остается добавить только секцию настройки драйверов в конфиг Klipper:

```
Тут будет конфиг
```